# Kahoot
Kahoot game with server and clients


נושא:
בפרויקט הגמר, התבקשתי לבנות ממשק שרת-לקוחות המשמש כמשחק "Kahoot" עם מס' חידונים רבי משתתפים. הלקוחות צריכים להתחבר לשרת ודרכו לקבל את השאלות, הנתונים על שאר המשתתפים וכד'.

נתונים טכניים:
1.	מערכת הפעלה: Windows
2.	שפת תכנות: python 3.9
3.	DB – לצורכי DB השתמשתי בקובץ DB.xml שנמצא בתיקייה יחד עם קבצי הפייתון. שם נשמרו משתמשים להתחברות (לדוגמא “user”, “1234”), והLeaderboard לכל קטגוריה

ספריות בשימוש:
1.	socket – משמש לתקשורת בין השרת ללקוחות.
2.	Tkinter – ספרייה המשמשת ליצירת GUI ללקוחות.
3.	Threading – משמש לניהול "תתי תהליכים" במקביל לתהליך הראשי.
4.	Json – מסייע בשימוש בקבצי JSON (לטובת העברת מסרים בין השרת ללקוחות).
5.	PIL (או pillow) – משמש לשינוי גודל התמונות אשר בשימוש הGUI.
6.	Cryptography – ספרייה המסייעת בהצפנה ופענוח מסרים (לטובת תקשורת בטוחה).
7.	Enum – משמש להגדרת enumerator לסוגי החידונים (יוסבר בהמשך).
8.	Xml – נועד לשימוש בקבצי XML לטובת DB.
 
קבצי הקוד - Server.py
כללי:
זהו הקובץ המייצג את השרת. קובץ זה מכיל את החישובים והלוגיקות שלקוחות מבקשים מהשרת. השרת מנהל במקביל תקשורת עם כל אחד מהלקוחות שפונים אליו, ומספק לכל לקוח את מה שהוא צריך.

מחלקות:
ENUM - Category:
לטובת ניהול נוח של החידונים, יצרתי Enum שמכיל את כל סוגי החידונים שיש לי:
Math לחידון מתמטי, Riddle לחידון עם שאלות היגיון וHistory לשאלות היסטוריה.
Question:
מחלקה המייצגת שאלה. לכל שאלה יש:
1.	קטגוריה (מתוך האופציות של Category)
2.	תוכן השאלה
3.	רשימת תשובות אפשריות
4.	אינדקס התשובה הראשונה מבין האופציות
5.	ספירת התשובות – סופר לכל תשובה אופציונלית כמה אנשים בחידון בחרו אותה (לטובת תצוגה גרפית)
Participant:
מחלקה המייצגת משתתף. לכל משתתף יש:
1.	כינוי לטובת המשחק
2.	קטגוריה (מתוך האופציות של Category)
3.	Conn – מייצגת את החיבור של השרת איתו (דרך רכיב זה השרת יכול להעביר הודעות ללקוח)
4.	סטטוס ready – מיועד לשלב ההמתנה
5.	סטטוס answered – מיועד לשלב בחידון
6.	Score – לשמירת ניקוד במהלך המשחק
 
Quiz:
מחלקה שמייצגת כל אחד מהחידונים (בהתאם לקטגוריות), לכל חידון יש:
1.	קטגוריה (מתוך האופציות של Category)
2.	רשימת משתתפים
3.	רשימת שאלות
4.	isON – סטטוס להאם כבר התחיל החידון
5.	isNextQuestion – סטטוס שמשמש לשלב השאלות (ונועד למנוע הודעות כפולות מלקוחות)
למחלקה יש בנוסף פונקציות להוספת שאלות ומשתתפים, ולהסרת משתתף לפי שם (מיועד למשתתף שיוצא בשלב כלשהו באמצע).

פונקציות:
על הפונקציות ננסה לעבור בקבוצות תחת אותה קטגוריה, ולבסוף נגיע לפונקציה ה"ראשית" שמטפלת בהודעות הלקוח.
Start_server:
הפונקציה שמתחילה את הקוד, השרת מתחילה להאזין בפורט 65432, ומחכה ללקוחות.

Encrypt & Decrypt:
פונקציות שמטרתן להצפין ולפענח הודעות, משתמשת במפתח ווקטור הצפנה שסוכמו מראש בין הלקוח לשרת, ומשתמשת בספריית Cryptography.

check_credentials:
פונקציה שבודקת מול הDB (DB.xml) האם השם משתמש וסיסמא קיימים.

get_leaderboard_scores & add_score_to_category 
פונקציות שמתקשרות עם הDB כדי לעדכן/לשלוף תוצאות הניקוד עבור הקטגוריה הנתונה.

broadcast_participants:
פונקציה שמעדכנת את כל המשתתפים בחידון בקטגוריה על שינוי ברשימת המשתתפים (מישהו הצטרף/עזב).

handle_ready_message:
פונקציה שבודקת אם כל המשתתפים בקטגוריה מוכנים, אם כן, מעדכנת את הלקוחות שמתחיל המשחק.

handle_request_next_question:
פונקציה שמעדכנת את כל השחקנים בשאלה הבאה, מופעלת רק עבור הלקוח הראשון שביקש לעבור לשאלה הבאה (כדי למנוע כפילויות).
אם נגמרו השאלות, מעדכנת את השחקנים שנגמר המשחק.

send_game_over_to_all_participants:
מעדכנת את כל השחקנים שנגמר החידון ומאפסת את המשתנים של הקטגוריה.

send_summary_to_all_participants:
בכל סוף שאלה, הפונקציה מעדכנת את הלקוחות בסטטוס הנוכחי – ניקוד כללי, כמה בחרו כל תשובה ומה התשובה הנכונה.

handle_answer:
הפונקציה מטפלת בתשובה שהתקבלה מהלקוח, בודקת אם היא נכונה, ואם כן, מוסיפה לשחקן ניקוד לפי הזמן שנותר לסוף השאלה (16 שניות == 16 נקודות).
אם זה השחקן האחרון שענה, שולחת summary.

send_question_to_all_participants:
השרת שולח (לפי בקשת הלקוח) את השאלה הבאה למשתתפים.

handle_client:
הפונקציה הגדולה של השרת, שמטפלת בהודעות ומנווטת אותם ליעד הרלוונטי. לכל לקוח שמתחבר היא מעדכנת גם את המס' הכולל המחובר. נמצאת בלולאה אינסופית שמקבלת הודעות מהלקוחות ופועלת בהתאם. מפונקציה זו באמת נשלחים לכל הפונקציות שפירטנו עליהם עד כה, תלוי בבקשת הלקוחות.
לאחר שיש ניתוק/תקלה, הלולאה יוצאת, השרת מפסיק להאזין ומוריד את כמות הלקוחות המחוברים.
 
קבצי הקוד - Client.py
כללי
קובץ זה מייצג את הלקוח, התפקוד העיקרי שלו זה הנגשת המידע ללקוח באמצעות GUI שונים לשלבים שונים (הרשמה, משחק וכד').
מסיבה זו, הוא מורכב ממספר חלקים שקשורים לשלבים שונים וממשקים שונים באפליקציה.

פונקציות:
Encrypt & Decrypt:
פונקציות שמטרתן להצפין ולפענח הודעות, משתמשת במפתח ווקטור הצפנה שסוכמו מראש בין הלקוח לשרת, ומשתמשת בספריית Cryptography.

Darken_color:
פונקצייה למטרות עיצוב, מחזירה גרסה כהה יותר של צבע נתון.

Is_Json:
בודקת האם קובץ מפורמט JSON.

connect_to_server:
תהליך ההתחברות לשרת, לאחריו הקישור נשמר במשתנה גלובלי לשימוש עתידי.

disconnect_from_server:
תהליך ההתנתקות מהשרת, שולח הודעת התנתקות ומנתק את הקשר.

calculate_window_height:
פונקציית עזר לעיצוב.

on_gui_close:
כאשר נסגר הGUI, דואג להתנתקות בטוחה מהשרת.
 
הרשמה
log_in_GUI:
העלאת הGUI הראשון של התחברות עם משתמש וסיסמא.

attempt_login:
ניסיון התחברות לשרת, מבצע התחברות ואז בודק מול השרת אם משתמש וסיסמא תקינים, אם כן ממשיך לחלון כניסה, אחרת מתנתק.

send_login_credentials:
יוצר את הודעת הבדיקה שנשלחת לשרת

חלון ראשי
create_gui:
יוצר את GUI הכניסה, בו ניתן לבחור כינוי ואיזה חידון רוצים.

on_register_click:
פועל כאשר מנסים להיכנס לחידון, לשרת נשלח הכינוי כדי לוודא שהוא לא תפוס כבר. אם הכול תקין, עבור למסך ההמתנה.

register_and_listen:
מאזין להודעות מהשאר בנוגע להצלחת ההרשמה.
 
חדר המתנה
החדר בו ממתינים שלא השחקנים שהצטרפו יהיו מוכנים.
open_waiting_room:
יצירת הGUI המתנה.

on_start_click:
פועל כאשר השחקן מעדכן שהוא מוכן למשחק. הלקוח שולח לשרת הודעת מוכן ומשנה את צבע כפתור ההתחלה.

listen_for_server_messages:
מקשיב להודעות השרת בשלב ההמתנה, למקרה שמגיע שחקן חדש או שהמשחק מתחיל.

safe_update_participants_list & update_participants_list_gui:
מעדכן את הממשק ברשימת השחקנים העדכנית בצורה בטוחה (בלי להתנגש עם Thread אחר).


GUI משחק
כאן קורה החידון, בכל שלב מוצגת שאלה עם 4 תשובות, וכאשר כולם ענו/נגמר הזמן מוצגות התוצאות עד לשאלה הבאה.

open_game_gui:
מעלה את GUI המשחק, כרגע את הגרף וניקוד מסתיר (עולים רק לאחר שאלה).

listen_for_server_messages_for_game:
מאזין להודעות מהשרת על שאלות חדשות ותוצאות.

request_next_question:
שולח הודעה לשרת בבקשה לשאלה חדשה (ומעביר לו גם את מס' השאלה האחרונה שהייתה).

update_gui_with_question:
מעדכן את הGUI עם שאלה חדשה. מעלים שוב את הגרף ותוצאות.

on_answer_click:
פועל לאחר בחירת תשובה, מעדכן את השרת מה התשובה שנבחרה.

Countdown & start_scoring_countdown:
ספירות לאחור לטובת זמן השאלה וזמן ה"המתנה" לשאלה החדשה.
כאשר מגיע ל0, עבור שאלה, אם הלקוח לא ענה, שולח לשרת תשובה "ריקה".
עבור זמן ההמתנה, אם אף לקוח אחר לא ביקש כבר, מבקש מהשרת שאלה חדשה.

handle_summary_message:
מנהל את עדכון ה"תוצאה" של הסיבוב – מציג כמה בחרו כל תשובה, מה התשובה הנכונה ומה הניקוד הכולל של המשחק נכון לעכשיו.

draw_chart & display_scores:
מייצר לפי הנתונים את הגרף שמציג כמה בחרו כל תשובה ומציג את הניקוד במשחק בסדר יורד (הכי גבוה למעלה).

תוצאה סופית
כאן מוצגות התוצאות הסופיות, עם המנצח, הניקוד של כל השחקנים, והleaderboard עבור חידון זה מאז ומעולם.
handle_game_over & show_game_over_gui:
מפעיל את הGUI של סיכום המשחק לפי הנתונים שהגיעו מהשרת.

restart_game:
לאחר לחיצה על restart, נחזור לחלון הראשי, בו ניתן לבחור חידון וכינוי חדשים.
